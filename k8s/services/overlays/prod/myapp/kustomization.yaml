apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: myapp-prod
labels:
  - pairs:
      app.kubernetes.io/instance: myapp-prod
    includeSelectors: true
    includeTemplates: true

resources:
  - namespace.yaml
  - ../../../base/myapp

components:
  - ../../../../components/myapp-db

configMapGenerator:
  - name: myapp-config
    behavior: merge
    literals:
      - DB_HOST=myapp-db-rw
      - DB_NAME=prod_myapp_db
      - DB_USER=prod_myapp_user
      - DB_DEBUG=true

secretGenerator:
  - name: myapp-db-creds
    type: kubernetes.io/basic-auth
    options:
      disableNameSuffixHash: true
    literals:
      - username=prod_myapp_user
      - password=prod_pass_123

images:
  - name: learningcloudnativego/myapp-app
    newTag: 2.0.0

patches:
  - path: patches/db-cluster.yaml
  - path: patches/deployment.yaml
  - path: patches/http-route.yaml
    target:
      kind: HTTPRoute
      name: myapp-route
